<div class="image-grid" (dragover)="allowDrop($event)" (drop)="onDrop($event)" (click)="openFileDialog()"
     [ngStyle]="{'width.px': isMobileView() ? '100%' : aspectRatio.width, 
     'height.px': isMobileView() ? screenHeight : aspectRatio.height}">
  <!-- Prompt instructions -->
  <input type="file" id="fileInput" style="display: none" (change)="onFileSelected($event)">
  @if (this.sharedService.getInstructionValue() && !showLoading) {
    <div id="instructions">Type a prompt and hit generate to start! Or click/tap here to add an image to use as a reference!</div>
  }


  <!-- Loading container -->
  @if (showLoading) {
    <div id="loading-container">
      <!-- Loading bar -->
      <div id="loading-bar">
        <div class="spinner-border text-primary" role="status"></div>
        <!-- Loading text -->
        <div id="queue-position">
          {{ queueStatusMessage ? queueStatusMessage : (queuePosition ? 'Queue Position: ' + queuePosition : 'Generating images...') }}
          @if (etaSeconds != null && !queueStatusMessage) {
            <div> ETA: {{ formatEta(etaSeconds) }}</div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Images -->
  @if (images.length > 0 && !showLoading && !showReferenceImage) {
    <div class="image-wrapper" id="wrapper1">
      <img [src]="images[0].url" class="small-image" alt="Image1 goes here" loading="lazy" decoding="async" (click)="inpaintingEnabled || expandImage(0, $event)" id="image0">
      <div class="image-actions">
        <button type="button" class="image-action-btn" (click)="downloadImage(images[0], $event)" aria-label="Download image 1">
          <i class="bi bi-download"></i>
        </button>
      </div>
    </div>
  }
  @if (images.length > 1 && !showLoading && !showReferenceImage) {
    <div class="image-wrapper" id="wrapper2">
      <img [src]="images[1].url" class="small-image" alt="Image2 goes here" loading="lazy" decoding="async" (click)="inpaintingEnabled || expandImage(1, $event)" id="image1">
      <div class="image-actions">
        <button type="button" class="image-action-btn" (click)="downloadImage(images[1], $event)" aria-label="Download image 2">
          <i class="bi bi-download"></i>
        </button>
      </div>
    </div>
  }
  @if (images.length > 2 && !showLoading && !showReferenceImage) {
    <div class="image-wrapper" id="wrapper3">
      <img [src]="images[2].url" class="small-image" alt="Image3 goes here" loading="lazy" decoding="async" (click)="inpaintingEnabled || expandImage(2, $event)" id="image2">
      <div class="image-actions">
        <button type="button" class="image-action-btn" (click)="downloadImage(images[2], $event)" aria-label="Download image 3">
          <i class="bi bi-download"></i>
        </button>
      </div>
    </div>
  }
  @if (images.length > 3 && !showLoading && !showReferenceImage) {
    <div class="image-wrapper" id="wrapper4">
      <img [src]="images[3].url" class="small-image" alt="Image4 goes here" loading="lazy" decoding="async" (click)="inpaintingEnabled || expandImage(3, $event)" id="image3">
      <div class="image-actions">
        <button type="button" class="image-action-btn" (click)="downloadImage(images[3], $event)" aria-label="Download image 4">
          <i class="bi bi-download"></i>
        </button>
      </div>
    </div>
  }
  @if (this.sharedService.getReferenceImageValue() && !showLoading && showReferenceImage) {
    <div class="reference-image" id="wrapper5">
      <img [src]="this.sharedService.getReferenceImageValue()!.url ?? this.sharedService.getReferenceImageValue()!.thumbnailUrl" alt="Reference Image goes here" loading="lazy" decoding="async" (click)="inpaintingEnabled || expandImage(4, $event)" id="referenceImage">
    </div>
  }
  <canvas #imageCanvas id="drawing-canvas" (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp()"></canvas>

</div>
