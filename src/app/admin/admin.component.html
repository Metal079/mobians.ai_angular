<div class="admin-wrapper p-3">
  <h2 class="mb-3">Admin</h2>

  <p-tabView>
    <p-tabPanel header="All LoRAs">
      <div class="tab-actions mb-2">
        <p-button label="Refresh" icon="pi pi-refresh" (onClick)="loadAllLoras()"></p-button>
      </div>
      <p-table
        [value]="allLoras"
        [loading]="loadingLoras"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10,20,50]"
        [resizableColumns]="true"
        [responsiveLayout]="'scroll'"
        [rowTrackBy]="trackById.bind(this)"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 64px">Preview</th>
            <th>Name</th>
            <th class="col-hide-sm">Version</th>
            <th class="col-hide-sm">Base Model</th>
            <th class="col-hide-sm">Uses</th>
            <th>Active</th>
            <th>NSFW</th>
            <th style="width: 220px">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
          <tr>
            <td>
              <img class="preview-img" [src]="row.image_url" [alt]="row.name" />
            </td>
            <td>{{ row.name }}</td>
            <td class="col-hide-sm">{{ row.version }}</td>
            <td class="col-hide-sm">{{ row.base_model }}</td>
            <td class="col-hide-sm">{{ row.uses }}</td>
            <td>
              <p-inputSwitch [(ngModel)]="row.is_active" (onChange)="toggleActive(row)"></p-inputSwitch>
            </td>
            <td>
              <p-inputSwitch [(ngModel)]="row.is_nsfw" (onChange)="toggleNSFW(row)"></p-inputSwitch>
            </td>
            <td>
              <p-button label="Details" icon="pi pi-info-circle" styleClass="p-button-text" (onClick)="openDetailsDialog('LoRA Details', row)"></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>

    <p-tabPanel header="LoRA Suggestions">
      <div class="tab-actions mb-2">
        <p-button label="Refresh" icon="pi pi-refresh" (onClick)="loadSuggestions()"></p-button>
      </div>
      <p-table
        [value]="loraSuggestions"
        [loading]="loadingSuggestions"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10,20,50]"
        [resizableColumns]="true"
        [responsiveLayout]="'scroll'"
        [rowTrackBy]="trackById.bind(this)"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 64px">Preview</th>
            <th>Name</th>
            <th class="col-hide-sm">Version</th>
            <th class="col-hide-sm">Base Model</th>
            <th class="col-hide-sm">Submitted By</th>
            <th style="width: 280px">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
          <tr>
            <td>
              <img class="preview-img" [src]="row.image_url || row.preview || row.thumbnail" [alt]="row.name" />
            </td>
            <td>{{ row.name }}</td>
            <td class="col-hide-sm">{{ row.version }}</td>
            <td class="col-hide-sm">{{ row.base_model }}</td>
            <td class="col-hide-sm">{{ row.submitted_by || row.username || '-' }}</td>
            <td class="action-buttons">
              <p-button label="Details" icon="pi pi-info-circle" styleClass="p-button-text" (onClick)="openDetailsDialog('Suggestion Details', row)"></p-button>
              <p-button label="Approve" icon="pi pi-check" styleClass="p-button-success" (onClick)="approveSuggestion(row)"></p-button>
              <p-button label="Reject" icon="pi pi-times" styleClass="p-button-danger" (onClick)="rejectSuggestion(row)"></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>
  </p-tabView>

  <!-- Details Dialog -->
  <p-dialog [(visible)]="detailsDialogVisible" [modal]="true" [style]="{width: '90vw', maxWidth: '700px'}" [header]="detailsDialogTitle">
    <pre style="white-space: pre-wrap">{{ detailsJson }}</pre>
  </p-dialog>
</div>
